"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createPackageJson = void 0;
const tslib_1 = require("tslib");
const devkit_1 = require("@nrwl/devkit");
const fs_1 = require("fs");
const lock_file_1 = require("nx/src/lock-file/lock-file");
function createPackageJson(options, context) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const packageJson = (0, devkit_1.createPackageJson)(context.projectName, context.projectGraph, {
            root: context.root,
            // By default we remove devDependencies since this is a production build.
            isProduction: options.includeDevDependenciesInPackageJson,
        });
        if (!packageJson.scripts) {
            packageJson.scripts = {};
        }
        packageJson.scripts.start = 'next start';
        const typescriptNode = context.projectGraph.externalNodes['npm:typescript'];
        if (typescriptNode) {
            packageJson.dependencies = packageJson.dependencies || {};
            packageJson.dependencies['typescript'] = typescriptNode.data.version;
        }
        (0, devkit_1.writeJsonFile)(`${options.outputPath}/package.json`, packageJson);
        // generate lock file
        const prunedLockFile = (0, devkit_1.createLockFile)(packageJson);
        const lockFileName = (0, lock_file_1.getLockFileName)();
        (0, fs_1.writeFileSync)(`${options.outputPath}/${lockFileName}`, prunedLockFile, {
            encoding: 'utf-8',
        });
    });
}
exports.createPackageJson = createPackageJson;
//# sourceMappingURL=create-package-json.js.map